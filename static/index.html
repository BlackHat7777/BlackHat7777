<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Secure Data Viewer</title>
  <style>
    body{font-family:Arial,Helvetica,sans-serif;margin:2rem;background:#f7f7f7}
    table{border-collapse:collapse;width:600px;background:#fff}
    th,td{padding:8px;border:1px solid #eee}
    #uploadRow{margin-top:1rem}
  </style>
</head>
<body>
  <h2>Uploaded Files</h2>
  <div>
    <label>Token: <input id="token" type="password" placeholder="Bearer token"></label>
    <button id="refresh">Refresh</button>
  </div>

  <div id="uploadRow">
    <input type="file" id="fileInput">
    <button id="uploadBtn">Upload</button>
  </div>

  <table id="tbl" style="margin-top:12px">
    <thead><tr><th>Filename</th><th>Action</th></tr></thead>
    <tbody></tbody>
  </table>

<script>
const API_BASE = ""; // same origin if you deploy backend + static together
function tokenHeader() {
  const t = document.getElementById("token").value;
  return { "Authorization": "Bearer " + t };
}

async function load() {
  const res = await fetch(API_BASE + "/files", { headers: tokenHeader() });
  if(!res.ok){ alert("Error: " + res.status); return; }
  const json = await res.json();
  const tbody = document.querySelector("#tbl tbody");
  tbody.innerHTML = "";
  json.files.forEach(fn => {
    const tr = document.createElement("tr");
    const link = `${API_BASE}/files/${encodeURIComponent(fn)}`;
    tr.innerHTML = `<td>${fn}</td>
      <td><a target="_blank" href="${link}">View</a></td>`;
    tbody.appendChild(tr);
  });
}

document.getElementById("refresh").addEventListener("click", load);

document.getElementById("uploadBtn").addEventListener("click", async () => {
  const input = document.getElementById("fileInput");
  if(!input.files.length) { alert("Choose a file"); return; }
  const fd = new FormData();
  fd.append("file", input.files[0]);
  const res = await fetch(API_BASE + "/upload", {
    method: "POST",
    headers: tokenHeader(),
    body: fd
  });
  if (res.ok) { alert("Uploaded"); load(); }
  else { const j = await res.json().catch(()=>null); alert("Upload failed: " + (j?.error || res.status)); }
});
</script>
</body>
</html>
